import { Link } from "react-router"
import { useSettings } from "../../context/settingsContext";

interface ListViewProps {
    dogs: Array<Pet>
}

export default function ListView({ dogs }: ListViewProps) {
    const { settings, updateSettings } = useSettings();

    const toggleFavorite = (dog: Pet, e: React.MouseEvent) => {
        e.preventDefault();
        e.stopPropagation();
        
        const isFavorited = settings.favourites.some(fav => fav.id === dog.id);
        let newFavourites: Pet[];
        
        if (isFavorited) {
            newFavourites = settings.favourites.filter(fav => fav.id !== dog.id);
        } else {
            newFavourites = [...settings.favourites, dog];
        }
        
        updateSettings({
            ...settings,
            favourites: newFavourites
        });
    };

    const isFavorited = (dogId: string) => {
        return settings.favourites.some(fav => fav.id === dogId);
    };

    return (
        <article className="view">
            {dogs.map((dog) => {
                const favorited = isFavorited(dog.id);
                return (
                    <div className="card" key={dog.id}>
                        <figure>
                            <img src={dog.image} />
                        </figure>

                        <Link
                            to={`/dog/${dog.id}`}
                        >
                            <div className="content">
                                <div className="top-row">
                                    <h2>{dog.breed}</h2>
                                    <button 
                                        className={`favorite ${favorited ? 'favorited' : ''}`}
                                        onClick={(e) => toggleFavorite(dog, e)}
                                        aria-label={favorited ? "Remove from favorites" : "Add to favorites"}
                                    >
                                        <svg
                                            width="12"
                                            height="12"
                                            viewBox="0 0 12 12"
                                            fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <path
                                                fillRule="evenodd"
                                                clipRule="evenodd"
                                                d="M7.45657 1.24754C7.85098 1.08411 8.27372 1 8.70064 1C9.12757 1 9.55031 1.08411 9.94472 1.24754C10.3391 1.41093 10.6973 1.6504 10.9991 1.95228C11.301 2.25405 11.5406 2.6125 11.704 3.00684C11.8674 3.40125 11.9516 3.82399 11.9516 4.25091C11.9516 4.67784 11.8674 5.10058 11.704 5.49499C11.5406 5.88936 11.3011 6.24767 10.9992 6.54947C10.9992 6.54949 10.9992 6.54944 10.9992 6.54947L6.5792 10.9695C6.38394 11.1647 6.06735 11.1647 5.87209 10.9695L1.45209 6.54947C0.842478 5.93985 0.5 5.11304 0.5 4.25091C0.5 3.38879 0.842478 2.56197 1.45209 1.95236C2.06171 1.34275 2.88852 1.00027 3.75065 1.00027C4.61277 1.00027 5.43958 1.34275 6.0492 1.95236L6.22565 2.12881L6.40201 1.95244C6.40198 1.95247 6.40204 1.95241 6.40201 1.95244C6.7038 1.65053 7.0622 1.41095 7.45657 1.24754ZM8.70064 2C8.40508 2 8.11241 2.05823 7.83936 2.17137C7.56631 2.28451 7.31823 2.45034 7.10928 2.65938L6.5792 3.18947C6.38394 3.38473 6.06735 3.38473 5.87209 3.18947L5.34209 2.65947C4.92001 2.23739 4.34755 2.00027 3.75065 2.00027C3.15374 2.00027 2.58128 2.23739 2.1592 2.65947C1.73712 3.08154 1.5 3.654 1.5 4.25091C1.5 4.84782 1.73712 5.42028 2.1592 5.84236L6.22565 9.90881L10.2921 5.84236C10.5011 5.63341 10.667 5.38525 10.7802 5.11219C10.8933 4.83914 10.9516 4.54648 10.9516 4.25091C10.9516 3.95535 10.8933 3.66268 10.7802 3.38963C10.667 3.11658 10.5012 2.86849 10.2922 2.65955C10.0832 2.45051 9.83498 2.28451 9.56193 2.17137C9.28887 2.05823 8.99621 2 8.70064 2Z"
                                                fill={favorited ? "#FF4B33" : "#BDBDBD"}
                                            />
                                        </svg>
                                    </button>
                                </div>

                                <div className="location-row">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="13" viewBox="0 0 12 13" fill="none">
                                        <path d="M9.55742 1.62357C8.60722 0.673315 7.34384 0.150002 6.00005 0.150002C4.65626 0.150002 3.39288 0.673315 2.4426 1.62354C1.4924 2.57375 0.969086 3.8371 0.969086 5.18089C0.969086 6.52466 1.4924 7.78804 2.4426 8.73829L5.75147 12.047C5.82012 12.1157 5.9101 12.15 6.00005 12.15C6.09003 12.15 6.18 12.1157 6.24865 12.047L9.55733 8.73829C10.5075 7.78806 11.0308 6.52469 11.0309 5.18087C11.0309 3.83708 10.5076 2.57373 9.55742 1.62357ZM9.06015 8.24111L6.00003 11.3013L2.93978 8.24111C1.2524 6.55368 1.2524 3.80809 2.93976 2.12075C3.75724 1.30332 4.84409 0.853128 6.00005 0.853128C7.15601 0.853128 8.24279 1.30332 9.06022 2.12075C10.7476 3.80809 10.7476 6.55368 9.06015 8.24111Z" fill="#5533EA" stroke="#5533EA" strokeWidth="0.3" />
                                        <path d="M7.58003 3.60095C7.15799 3.17893 6.59689 2.94653 6.00006 2.94653C5.40324 2.94653 4.84213 3.17893 4.42013 3.60095C3.99809 4.02297 3.76569 4.58408 3.76569 5.18092C3.76569 5.77774 3.99812 6.33886 4.42013 6.76087C4.84213 7.18289 5.40322 7.4153 6.00006 7.4153C6.59689 7.4153 7.15801 7.18289 7.58003 6.76085C8.00204 6.33883 8.23448 5.77774 8.23448 5.1809C8.23448 4.58406 8.00207 4.02297 7.58003 3.60095ZM7.08282 6.26364C6.79361 6.55286 6.40907 6.71215 6.00003 6.71215C5.59103 6.71215 5.20651 6.55286 4.91729 6.26367C4.62807 5.97445 4.46879 5.58993 4.46879 5.18092C4.46879 4.77191 4.62807 4.38737 4.91729 4.09813C5.20649 3.80893 5.59103 3.64965 6.00003 3.64965C6.40907 3.64965 6.79358 3.80893 7.0828 4.09813C7.37202 4.38733 7.5313 4.77187 7.5313 5.18088C7.53133 5.58991 7.37207 5.97442 7.08282 6.26364Z" fill="#5533EA" stroke="#5533EA" strokeWidth="0.3" />
                                    </svg>
                                    <span className="location">{dog.location}</span>
                                </div>

                                <p className="description">{dog.short_description}</p>
                            </div>
                        </Link>
                    </div>
                );
            })}
        </article>
    );
}
